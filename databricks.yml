bundle:
  #name: hello-bundle
  name: jenkins-demo-bundle

targets:
  dev:
    mode: development
    workspace:
      host: https://loyalty-nz-terraform-databricks-production.cloud.databricks.com 
    default: true
    resources:
      jobs:
        hello-job:
          name: dev-hello-job
          tasks:
            - task_key: hello-task
              existing_cluster_id: 0115-013817-hjs4cq6m
              notebook_task:
                notebook_path: ./hello.ipynb
  qa:
    workspace:
      host: https://loyalty-nz-terraform-databricks-production.cloud.databricks.com 
    resources:
      jobs:
        hello-job:
          name: qa-hello-job
          tasks:
            - task_key: hello-task
              existing_cluster_id: 0115-013817-hjs4cq6m
              notebook_task:
                notebook_path: ./hello.ipynb

  prod:
    workspace:
      host: https://loyalty-nz-terraform-databricks-production.cloud.databricks.com 
    resources:
        pipelines:
    # Our DLT pipeline
          databricks_jenkins_demo_pipeline:
            name: Jenkins demo FE Medium Metrics Pipeline"
            target: "Jenkins_demo_medium_post_report"
            libraries:
              - file:
                  path: ./ingest.py
              - file:
                  path: ./get_metrics.py
            channel: preview
            configuration:
              "bundle.file_path": "/Workspace/${workspace.file_path}"

        jobs:
          # A two-task Databricks Workflow - dlt + notebook report
          databricks_jenkins_demo_job:
            name: Jenkins demo Metrics for FE Medium Posts"
            tasks:
              - task_key: mo_dlt_medium_pipeline
                pipeline_task:
                  pipeline_id: ${resources.pipelines.databricks_jenkins_demo_pipeline.id}
              - task_key: "prod_medium_notebook_report"
                depends_on:
                  - task_key: mo_dlt_medium_pipeline
                existing_cluster_id: 0115-013817-hjs4cq6m  
                notebook_task:
                  base_parameters:
                    dbname: "mo_medium_post_report_prod"
                  notebook_path: ./fe_medium_report.py